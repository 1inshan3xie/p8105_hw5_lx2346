---
title: "p8105_hw5_lx2346"
author: "linshan"
date: "2024-11-02"
output: github_document
---

```{r include = FALSE, message = FALSE, warning = FALSE}
library(ggplot2)
library(tidyverse)
library(purrr)
```

## Problem 1
### create a function to check whether there is a replicate
```{r}
bdays_sim = function(n) {
  bdays = sample(1:365, size = n, replace = TRUE)
  length(unique(bdays)) < n
  duplicate = length(unique(bdays)) < n
  return(duplicate)
}
```
### run this function 10000 times for each group size between 2 and 50
```{r}
sim_res = expand_grid(
  n = 2:50,
  iter = 1:10000
) |>
  mutate(res = map_lgl(n, bdays_sim)) |>
  group_by(n) |>
  summarize(prob = mean(res))

sim_res
```
### Make a plot showing the probability as a function of group size, and comment on your results.
```{r}
sim_res |>
  ggplot(aes(x = n, y = prob)) +
  geom_line()
```
\
**Comment**:As the group size increases, the probability that two people share the same birthday also increases. When n = 23， the probability exceeds 0.5.

## Prblem 2
### Generate 5000 datasets from the model 𝑥∼𝑁𝑜𝑟𝑚𝑎𝑙[𝜇,𝜎]
```{r}
normal_sim = function(miu = 0, sample_size = 30, sigma = 5) {
  sim_data = tibble(x_vec = rnorm(sample_size, miu , sigma))
  
  test_result = t.test(sim_data$x_vec, mu = miu)
  res_clean = broom::tidy(test_result)
  
  out_df = tibble(mu_hat = res_clean$estimate,
                  p_value = res_clean$p.value)
  
  return(out_df)
}
```

```{r}
sim_res_2 = 
  tibble(
    iter = 1:5000
  )|>
  mutate(samp_res = map(iter, normal_sim)) |>
  unnest(samp_res)

sim_res_2
```


### Repeat the above for 𝜇={1,2,3,4,5,6}
```{r}
sim_res_3 = 
  expand_grid(
    n = c(1, 2, 3, 4, 5, 6),
    iter = 1:5000
  )|>
  mutate(samp_res = map(n, \(x) normal_sim(miu = x, sample_size = 30, sigma = 5))) |>
  unnest(samp_res)
```

### Make a plot showing the proportion of times the null was rejected (the power of the test) on the y axis and the true value of 𝜇 on the x axis.
```{r}
sim_res_3 |>
  group_by(n) |>
  summarize(power = mean(p_value < 0.05)) |>
  ggplot(aes(x = n, y = power)) +
  geom_line() +
  geom_point() +
  labs(x = "True Value of μ", y = "Power", title = "Power vs. True μ") +
  theme(plot.title = element_text(hjust = 0.5)) +
  scale_x_continuous(breaks = seq(1, 6, by = 1))
```

### Make a plot showing the average estimate of 𝜇̂ on the y axis and the true value of 𝜇 on the x axis + a second plot showing the average estimate of 𝜇̂ only in samples for which the null was rejected on the y axis and the true value of 𝜇 on the x axis.
```{r}
mean_mu = sim_res_3 |>
  group_by(n) |>
  summarize(mean_mu = mean(mu_hat))

mean_mu_rej = sim_res_3 |>
  filter(p_value < 0.05) |>
  group_by(n) |>
  summarize(mean_mu_rej = mean(mu_hat))

mu_df = left_join(mean_mu, mean_mu_rej, by = "n")

mu_df |>
  ggplot(aes(x = n)) +
  geom_line(aes(y = mean_mu, color = "Average μ̂"), size = 1 )+
  geom_point(aes(y = mean_mu), shape = 1, size = 3) +
  geom_line(aes(y = mean_mu_rej,color = "Average μ̂ (Null Rejected)"),size = 1)+
  geom_point(aes(y = mean_mu_rej), shape = 2, size = 3) +
  labs(title = "Average Estimate of μ̂ vs True Value of μ",
       x = "True Value of μ",
       y = "Average Estimate of μ̂",
       color = "Legend") +
  
```







