p8105_hw5_lx2346
================
linshan
2024-11-02

## Problem 1

### create a function to check whether there is a replicate

``` r
bdays_sim = function(n) {
  bdays = sample(1:365, size = n, replace = TRUE)
  length(unique(bdays)) < n
  duplicate = length(unique(bdays)) < n
  return(duplicate)
}
```

### run this function 10000 times for each group size between 2 and 50

``` r
sim_res = expand_grid(
  n = 2:50,
  iter = 1:10000
) |>
  mutate(res = map_lgl(n, bdays_sim)) |>
  group_by(n) |>
  summarize(prob = mean(res))

sim_res
```

    ## # A tibble: 49 Ã— 2
    ##        n   prob
    ##    <int>  <dbl>
    ##  1     2 0.0033
    ##  2     3 0.0078
    ##  3     4 0.0157
    ##  4     5 0.0245
    ##  5     6 0.0425
    ##  6     7 0.0558
    ##  7     8 0.0746
    ##  8     9 0.0939
    ##  9    10 0.115 
    ## 10    11 0.146 
    ## # â„¹ 39 more rows

### Make a plot showing the probability as a function of group size, and comment on your results.

``` r
sim_res |>
  ggplot(aes(x = n, y = prob)) +
  geom_line()
```

![](p8105_hw5_lx2346_files/figure-gfm/unnamed-chunk-4-1.png)<!-- -->  
**Comment**:As the group size increases, the probability that two people
share the same birthday also increases. When n = 23ï¼Œ the probability
exceeds 0.5.

## Prblem 2

### Generate 5000 datasets from the model ð‘¥âˆ¼ð‘ð‘œð‘Ÿð‘šð‘Žð‘™\[ðœ‡,ðœŽ\]

``` r
normal_sim = function(miu = 0, sample_size = 30, sigma = 5) {
  sim_data = tibble(x_vec = rnorm(sample_size, miu , sigma))
  
  test_result = t.test(sim_data$x_vec, mu = 0)
  res_clean = broom::tidy(test_result)
  
  out_df = tibble(mu_hat = res_clean$estimate,
                  p_value = res_clean$p.value)
  
  return(out_df)
}
```

``` r
sim_res_2 = 
  tibble(
    iter = 1:5000
  )|>
  mutate(samp_res = map(iter, normal_sim)) |>
  unnest(samp_res)

sim_res_2
```

    ## # A tibble: 5,000 Ã— 3
    ##     iter mu_hat  p_value
    ##    <int>  <dbl>    <dbl>
    ##  1     1  0.682 5.54e- 1
    ##  2     2  2.59  1.76e- 4
    ##  3     3  4.00  4.73e- 5
    ##  4     4  3.76  5.13e- 4
    ##  5     5  5.84  3.11e- 6
    ##  6     6  4.59  1.66e- 5
    ##  7     7  7.77  2.38e-10
    ##  8     8  8.91  5.88e- 9
    ##  9     9  8.51  1.19e-10
    ## 10    10  9.35  6.92e-15
    ## # â„¹ 4,990 more rows

### Repeat the above for ðœ‡={1,2,3,4,5,6}

``` r
sim_res_3 = 
  expand_grid(
    n = c(1, 2, 3, 4, 5, 6),
    iter = 1:5000
  )|>
  mutate(samp_res = map(n, \(x) normal_sim(miu = x, sample_size = 30, sigma = 5))) |>
  unnest(samp_res)
```

### Make a plot showing the proportion of times the null was rejected (the power of the test) on the y axis and the true value of ðœ‡ on the x axis.

``` r
sim_res_3 |>
  group_by(n) |>
  summarize(power = mean(p_value < 0.05)) |>
  ggplot(aes(x = n, y = power)) +
  geom_line() +
  geom_point() +
  labs(x = "True Value of Î¼", y = "Power", title = "Power vs. True Î¼") +
  theme(plot.title = element_text(hjust = 0.5)) +
  scale_x_continuous(breaks = seq(1, 6, by = 1))
```

![](p8105_hw5_lx2346_files/figure-gfm/unnamed-chunk-8-1.png)<!-- -->
**Describe the association between effect size and power**: The effect
size is the difference between the true mean Î¼ and the null hypothesis
(0). As we can see from the plot, there is a positive association
between effect size and power. As the effect size increases, the power
of the statistical test also increases. This is because larger effect
sizes are easier to detect against the backdrop of variability in the
data.

### Make a plot showing the average estimate of ðœ‡Ì‚ on the y axis and the true value of ðœ‡ on the x axis + a second plot showing the average estimate of ðœ‡Ì‚ only in samples for which the null was rejected on the y axis and the true value of ðœ‡ on the x axis.

``` r
mean_mu = sim_res_3 |>
  group_by(n) |>
  summarize(mean_mu = mean(mu_hat))

mean_mu_rej = sim_res_3 |>
  filter(p_value < 0.05) |>
  group_by(n) |>
  summarize(mean_mu_rej = mean(mu_hat))

mu_df = left_join(mean_mu, mean_mu_rej, by = "n")

mu_df |>
  ggplot(aes(x = n)) +
  geom_line(aes(y = mean_mu, color = "Average Î¼Ì‚"), size = 1.5 )+
  geom_point(aes(y = mean_mu), shape = 1, size = 3) +
  geom_line(aes(y = mean_mu_rej,color = "Average Î¼Ì‚ (Null Rejected)"))+
  geom_point(aes(y = mean_mu_rej), shape = 2, size = 3) +
  labs(title = "Average Estimate of Î¼Ì‚ vs True Value of Î¼",
       x = "True Value of Î¼",
       y = "Average Estimate of Î¼Ì‚",
       color = "Legend") +
  theme(plot.title = element_text(hjust = 0.5)) +
  scale_x_continuous(breaks = seq(1, 6, by = 1)) +
  scale_y_continuous(breaks = seq(1, 6, by = 1))
```

    ## Warning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.
    ## â„¹ Please use `linewidth` instead.
    ## This warning is displayed once every 8 hours.
    ## Call `lifecycle::last_lifecycle_warnings()` to see where this warning was
    ## generated.

![](p8105_hw5_lx2346_files/figure-gfm/unnamed-chunk-9-1.png)<!-- -->  
**Comment**: It can be observed that as the true value of Î¼ increases,
the average Î¼Ì‚ gradually approaches the average Î¼Ì‚ (Null Rejected). This
indicates that with an increase in effect size, more samples are being
rejected, meaning that the power of the test is gradually increasing.
